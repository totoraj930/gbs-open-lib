"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { newObj[key] = obj[key]; } } } newObj.default = obj; return newObj; } } function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }// src/redis/config.ts
var _zod = require('zod');
var _dotenv = require('dotenv'); var dotenv = _interopRequireWildcard(_dotenv); var dotenv6 = _interopRequireWildcard(_dotenv); var dotenv2 = _interopRequireWildcard(_dotenv); var dotenv3 = _interopRequireWildcard(_dotenv); var dotenv4 = _interopRequireWildcard(_dotenv); var dotenv5 = _interopRequireWildcard(_dotenv);
dotenv.config();
var zRedisConfig = _zod.z.object({
  REDIS_HOST: _zod.z.string(),
  REDIS_PORT: _zod.z.string(),
  REDIS_PASS: _zod.z.string()
});
var redisEnv = zRedisConfig.parse(process.env);

// src/redis/index.ts
var _ioredis = require('ioredis'); var _ioredis2 = _interopRequireDefault(_ioredis);

// src/redis/schema.ts

var zRawRaidTweetMini = _zod.z.object({
  n: _zod.z.string(),
  // name
  sn: _zod.z.string(),
  // screen_name
  en: _zod.z.string(),
  // enemy_name
  ui: _zod.z.string(),
  // user_id
  ti: _zod.z.string(),
  // tweet_id
  bi: _zod.z.string(),
  // battle_id
  lv: _zod.z.string(),
  // level
  l: _zod.z.enum(["en", "ja"]),
  // language
  t: _zod.z.number(),
  // time
  et: _zod.z.number(),
  // elapsed_time
  c: _zod.z.string().optional()
  // comment
});
function minifyRawRaidTweet(tweet) {
  return {
    n: tweet.name,
    sn: tweet.screen_name,
    en: tweet.enemy_name,
    ui: tweet.user_id,
    ti: tweet.tweet_id,
    bi: tweet.battle_id,
    lv: tweet.level,
    l: tweet.language,
    t: tweet.time,
    et: tweet.elapsed_time,
    c: tweet.comment
  };
}
function unpackRawRaidTweetMini(mini) {
  return {
    name: mini.n,
    screen_name: mini.sn,
    enemy_name: mini.en,
    user_id: mini.ui,
    tweet_id: mini.ti,
    battle_id: mini.bi,
    level: mini.lv,
    language: mini.l,
    time: mini.t,
    comment: mini.c,
    elapsed_time: mini.et
  };
}
var zRaidTweetMini = _zod.z.object({
  n: _zod.z.string(),
  // name
  sn: _zod.z.string(),
  // screen_name
  ui: _zod.z.string(),
  // user_id
  ti: _zod.z.string(),
  // tweet_id
  bi: _zod.z.string(),
  // battle_id
  ei: _zod.z.number(),
  // enemy_id(-1はリスト外)
  lv: _zod.z.string().optional(),
  // level
  en: _zod.z.string().optional(),
  // enemy_name
  l: _zod.z.enum(["en", "ja"]),
  // language
  t: _zod.z.number(),
  // time
  et: _zod.z.number(),
  // elapsed_time
  ft: _zod.z.number(),
  // first time(初回投稿時間)
  c: _zod.z.string().optional()
  // comment
});

// src/redis/index.ts
var _mitt = require('mitt'); var _mitt2 = _interopRequireDefault(_mitt);
var redisOps = {
  host: redisEnv.REDIS_HOST,
  password: redisEnv.REDIS_PASS,
  port: Number.parseInt(redisEnv.REDIS_PORT)
};
function getRawChClient(chName = "gbs-open-raw") {
  const receiver = _mitt2.default.call(void 0, );
  const subRedis = new (0, _ioredis2.default)(redisOps);
  subRedis.subscribe(chName);
  subRedis.on("message", (ch, json) => {
    try {
      const mini = zRawRaidTweetMini.parse(JSON.parse(json));
      receiver.emit("tweet", mini);
    } catch (e) {
    }
  });
  return receiver;
}
function getRaidTweetChClient(chName = "gbs-open-tweet") {
  const receiver = _mitt2.default.call(void 0, );
  const subRedis = new (0, _ioredis2.default)(redisOps);
  subRedis.subscribe(chName);
  subRedis.on("message", (ch, json) => {
    try {
      const mini = zRaidTweetMini.parse(JSON.parse(json));
      receiver.emit("tweet", mini);
    } catch (e2) {
    }
  });
  return receiver;
}
var pubRedis = new (0, _ioredis2.default)(redisOps);
function sendRawRaidTweet(tweet, chName = "gbs-open-raw") {
  const mini = minifyRawRaidTweet(tweet);
  const json = JSON.stringify(mini);
  pubRedis.publish(chName, json);
}
function sendRaidTweet(tweet, chName = "gbs-open-tweet") {
  const json = JSON.stringify(tweet);
  pubRedis.publish(chName, json);
}

// src/config.ts


// src/cache/config.ts


dotenv2.config();
var zCacheConfig = _zod.z.object({
  CACHE_PORT: _zod.z.string(),
  GBS_LIST: _zod.z.string().url()
});
var cacheEnv = zCacheConfig.parse(process.env);

// src/site/config.ts


dotenv3.config();
var zSiteConfig = _zod.z.object({
  PORT: _zod.z.string()
});
var siteEnv = zSiteConfig.parse(process.env);

// src/tweet/config.ts


dotenv4.config();
var zTweetConfig = _zod.z.object({
  BEARER: _zod.z.string(),
  OAUTH_CALLBACK: _zod.z.string().url(),
  CONSUMER_KEY: _zod.z.string(),
  CONSUMER_SECRET: _zod.z.string()
});
var tweetEnv = zTweetConfig.parse(process.env);

// src/stream/config.ts


dotenv5.config();
var zStreamConfig = _zod.z.object({
  STREAM_PORT: _zod.z.string()
});
var streamEnv = zStreamConfig.parse(process.env);

// src/config.ts
dotenv6.config();
var zAllConfig = zCacheConfig.merge(zSiteConfig).merge(zRedisConfig).merge(zTweetConfig).merge(zStreamConfig);
var allEnv = zAllConfig.parse(process.env);












exports.allEnv = allEnv; exports.getRaidTweetChClient = getRaidTweetChClient; exports.getRawChClient = getRawChClient; exports.minifyRawRaidTweet = minifyRawRaidTweet; exports.redisOps = redisOps; exports.sendRaidTweet = sendRaidTweet; exports.sendRawRaidTweet = sendRawRaidTweet; exports.unpackRawRaidTweetMini = unpackRawRaidTweetMini; exports.zAllConfig = zAllConfig; exports.zRaidTweetMini = zRaidTweetMini; exports.zRawRaidTweetMini = zRawRaidTweetMini;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2dicy1vcGVuL3NyYy9yZWRpcy9jb25maWcudHMiLCIuLi9nYnMtb3Blbi9zcmMvcmVkaXMvaW5kZXgudHMiLCIuLi9nYnMtb3Blbi9zcmMvcmVkaXMvc2NoZW1hLnRzIiwiLi4vZ2JzLW9wZW4vc3JjL2NvbmZpZy50cyIsIi4uL2dicy1vcGVuL3NyYy9jYWNoZS9jb25maWcudHMiLCIuLi9nYnMtb3Blbi9zcmMvc2l0ZS9jb25maWcudHMiLCIuLi9nYnMtb3Blbi9zcmMvdHdlZXQvY29uZmlnLnRzIiwiLi4vZ2JzLW9wZW4vc3JjL3N0cmVhbS9jb25maWcudHMiXSwibmFtZXMiOlsieiIsImRvdGVudiJdLCJtYXBwaW5ncyI6IjtBQUFBLFNBQVMsU0FBUztBQUNsQixZQUFZLFlBQVk7QUFDakIsY0FBTztBQUVQLElBQU0sZUFBZSxFQUFFLE9BQU87QUFBQSxFQUNuQyxZQUFZLEVBQUUsT0FBTztBQUFBLEVBQ3JCLFlBQVksRUFBRSxPQUFPO0FBQUEsRUFDckIsWUFBWSxFQUFFLE9BQU87QUFDdkIsQ0FBQztBQUVNLElBQU0sV0FBVyxhQUFhLE1BQU0sUUFBUSxHQUFHOzs7QUNSdEQsT0FBTyxXQUFXOzs7QUNEbEIsU0FBUyxLQUFBQSxVQUFTO0FBS1gsSUFBTSxvQkFBb0JBLEdBQUUsT0FBTztBQUFBLEVBQ3hDLEdBQUdBLEdBQUUsT0FBTztBQUFBO0FBQUEsRUFDWixJQUFJQSxHQUFFLE9BQU87QUFBQTtBQUFBLEVBQ2IsSUFBSUEsR0FBRSxPQUFPO0FBQUE7QUFBQSxFQUNiLElBQUlBLEdBQUUsT0FBTztBQUFBO0FBQUEsRUFDYixJQUFJQSxHQUFFLE9BQU87QUFBQTtBQUFBLEVBQ2IsSUFBSUEsR0FBRSxPQUFPO0FBQUE7QUFBQSxFQUNiLElBQUlBLEdBQUUsT0FBTztBQUFBO0FBQUEsRUFDYixHQUFHQSxHQUFFLEtBQUssQ0FBQyxNQUFNLElBQUksQ0FBQztBQUFBO0FBQUEsRUFDdEIsR0FBR0EsR0FBRSxPQUFPO0FBQUE7QUFBQSxFQUNaLElB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QkFBZ0JELEdBQUUsT0FBTztBQUFBLEVBQ3BDLGFBQWFBLEdBQUUsT0FBTztBQUN4QixDQUFDO0FBRU0sSUFBTSxZQUFZLGNBQWMsTUFBTSxRQUFRLEdBQUc7OztBSkZqRCxlQUFPO0FBRVAsSUFBTSxhQUFhLGFBQ3ZCLE1BQU0sV0FBVyxFQUNqQixNQUFNLFlBQVksRUFDbEIsTUFBTSxZQUFZLEVBQ2xCLE1BQU0sYUFBYTtBQUVmLElBQU0sU0FBUyxXQUFXLE1BQU0sUUFBUSxHQUFHIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XHJcbmltcG9ydCAqIGFzIGRvdGVudiBmcm9tICdkb3RlbnYnO1xyXG5kb3RlbnYuY29uZmlnKCk7XHJcblxyXG5leHBvcnQgY29uc3QgelJlZGlzQ29uZmlnID0gei5vYmplY3Qoe1xyXG4gIFJFRElTX0hPU1Q6IHouc3RyaW5nKCksXHJcbiAgUkVESVNfUE9SVDogei5zdHJpbmcoKSxcclxuICBSRURJU19QQVNTOiB6LnN0cmluZygpLFxyXG59KTtcclxuXHJcbmV4cG9ydCBjb25zdCByZWRpc0VudiA9IHpSZWRpc0NvbmZpZy5wYXJzZShwcm9jZXNzLmVudik7XHJcbiIsImltcG9ydCB7IHJlZGlzRW52IH0gZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IHsgUmF3UmFpZFR3ZWV0IH0gZnJvbSAnQC90d2VldC9yZWNlaXZlcic7XG5pbXBvcnQgUmVkaXMgZnJvbSAnaW9yZWRpcyc7XG5pbXBvcnQge1xuICBtaW5pZnlSYXdSYWlkVHdlZXQsXG4gIFJhaWRUd2VldE1pbmksXG4gIFJhd1JhaWRUd2VldE1pbmksXG4gIHpSYWlkVHdlZXRNaW5pLFxuICB6UmF3UmFpZFR3ZWV0TWluaSxcbn0gZnJvbSAnLi9zY2hlbWEnO1xuaW1wb3J0IG1pdHQgZnJvbSAnbWl0dCc7XG5cbmV4cG9ydCBjb25zdCByZWRpc09wcyA9IHtcbiAgaG9zdDogcmVkaXNFbnYuUkVESVNfSE9TVCxcbiAgcGFzc3dvcmQ6IHJlZGlzRW52LlJFRElTX1BBU1MsXG4gIHBvcnQ6IE51bWJlci5wYXJzZUludChyZWRpc0Vudi5SRURJU19QT1JUKSxcbn07XG5cbnR5cGUgUmF3Q2hFdmVudHMgPSB7XG4gIHR3ZWV0OiBSYXdSYWlkVHdlZXRNaW5pO1xufTtcbi8qKlxuICog55Sf44Gu44OE44Kk44O844OI5Y+X5L+h5qmfXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRSYXdDaENsaWVudChjaE5hbWUgPSAnZ2JzLW9wZW4tcmF3Jykge1xuICBjb25zdCByZWNlaXZlciA9IG1pdHQ8UmF3Q2hFdmVudHM+KCk7XG4gIGNvbnN0IHN1YlJlZGlzID0gbmV3IFJlZGlzKHJlZGlzT3BzKTtcbiAgc3ViUmVkaXMuc3Vic2NyaWJlKGNoTmFtZSk7XG4gIHN1YlJlZGlzLm9uKCdtZXNzYWdlJywgKGNoLCBqc29uKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1pbmkgPSB6UmF3UmFpZFR3ZWV0TWluaS5wYXJzZShKU09OLnBhcnNlKGpzb24pKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKERhdGUubm93KCkgLSBtaW5pLnQsIG1pbmkuYmksIGBMdi4ke21pbmkubHZ9YCwgbWluaS5lbik7XG4gICAgICByZWNlaXZlci5lbWl0KCd0d2VldCcsIG1pbmkpO1xuICAgIH0gY2F0Y2gge31cbiAgfSk7XG4gIHJldHVybiByZWNlaXZlcjtcbn1cblxudHlwZSBSYWlkVHdlZXRDaEV2ZW50cyA9IHtcbiAgdHdlZXQ6IFJhaWRUd2VldE1pbmk7XG59O1xuLyoqXG4gKiDlrozmiJDmuIjjgb/jga7jg4TjgqTjg7zjg4jlj5fkv6HmqZ9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFJhaWRUd2VldENoQ2xpZW50KGNoTmFtZSA9ICdnYnMtb3Blbi10d2VldCcpIHtcbiAgY29uc3QgcmVjZWl2ZXIgPSBtaXR0PFJhaWRUd2VldENoRXZlbnRzPigpO1xuICBjb25zdCBzdWJSZWRpcyA9IG5ldyBSZWRpcyhyZWRpc09wcyk7XG4gIHN1YlJlZGlzLnN1YnNjcmliZShjaE5hbWUpO1xuICBzdWJSZWRpcy5vbignbWVzc2FnZScsIChjaCwganNvbikgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtaW5pID0gelJhaWRUd2VldE1pbmkucGFyc2UoSlNPTi5wYXJzZShqc29uKSk7XG4gICAgICByZWNlaXZlci5lbWl0KCd0d2VldCcsIG1pbmkpO1xuICAgIH0gY2F0Y2gge31cbiAgfSk7XG4gIHJldHVybiByZWNlaXZlcjtcbn1cblxuLyoqXG4gKiDpgIHkv6HnlKhSZWRpc+OCr+ODqeOCpOOCouODs+ODiFxuICovXG5jb25zdCBwdWJSZWRpcyA9IG5ldyBSZWRpcyhyZWRpc09wcyk7XG5cbi8qKlxuICog55Sf44Gu44OE44Kk44O844OI44OH44O844K/44KS6YCB5L+hXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZW5kUmF3UmFpZFR3ZWV0KHR3ZWV0OiBSYXdSYWlkVHdlZXQsIGNoTmFtZSA9ICdnYnMtb3Blbi1yYXcnKSB7XG4gIGNvbnN0IG1pbmkgPSBtaW5pZnlSYXdSYWlkVHdlZXQodHdlZXQpO1xuICBjb25zdCBqc29uID0gSlNPTi5zdHJpbmdpZnkobWluaSk7XG4gIHB1YlJlZGlzLnB1Ymxpc2goY2hOYW1lLCBqc29uKTtcbn1cblxuLyoqXG4gKiDliqDlt6XmuIjjgb/jga7jg4TjgqTjg7zjg4jjg4fjg7zjgr/jgpLpgIHkv6FcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNlbmRSYWlkVHdlZXQodHdlZXQ6IFJhaWRUd2VldE1pbmksIGNoTmFtZSA9ICdnYnMtb3Blbi10d2VldCcpIHtcbiAgY29uc3QganNvbiA9IEpTT04uc3RyaW5naWZ5KHR3ZWV0KTtcbiAgcHViUmVkaXMucHVibGlzaChjaE5hbWUsIGpzb24pO1xufVxuIiwiaW1wb3J0IHsgUmF3UmFpZFR3ZWV0IH0gZnJvbSAnQC90d2VldC9yZWNlaXZlcic7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuLyoqXG4gKiBSZWRpc+mAgeS/oeeUqOOBruaWh+Wtl+aVsOOCkuaKkeOBiOOBn1JhaWRUd2VldFxuICovXG5leHBvcnQgY29uc3QgelJhd1JhaWRUd2VldE1pbmkgPSB6Lm9iamVjdCh7XG4gIG46IHouc3RyaW5nKCksIC8vIG5hbWVcbiAgc246IHouc3RyaW5nKCksIC8vIHNjcmVlbl9uYW1lXG4gIGVuOiB6LnN0cmluZygpLCAvLyBlbmVteV9uYW1lXG4gIHVpOiB6LnN0cmluZygpLCAvLyB1c2VyX2lkXG4gIHRpOiB6LnN0cmluZygpLCAvLyB0d2VldF9pZFxuICBiaTogei5zdHJpbmcoKSwgLy8gYmF0dGxlX2lkXG4gIGx2OiB6LnN0cmluZygpLCAvLyBsZXZlbFxuICBsOiB6LmVudW0oWydlbicsICdqYSddKSwgLy8gbGFuZ3VhZ2VcbiAgdDogei5udW1iZXIoKSwgLy8gdGltZVxuICBldDogei5udW1iZXIoKSwgLy8gZWxhcHNlZF90aW1lXG4gIGM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSwgLy8gY29tbWVudFxufSk7XG5cbi8qKlxuICog5a++5b+cXFxcbiAqIG46IG5hbWVcXFxuICogc246IHNjcmVlX25hbWVcXFxuICogZW46IGVuZW15X25hbWVcXFxuICogdWk6IHVzZXJfaWRcXFxuICogdGk6IHR3ZWV0X2lkXFxcbiAqIGJpOiBiYXR0bGVfaWRcXFxuICogbHY6IGxldmVsXFxcbiAqIGw6IGxhbmd1YWdlXFxcbiAqIHQ6IHRpbWVcXFxuICogZXQ6IGVsYXBzZWRfdGltZVxcXG4gKiBjOiBjb21tZW50XG4gKi9cbmV4cG9ydCB0eXBlIFJhd1JhaWRUd2VldE1pbmkgPSB6LmluZmVyPHR5cGVvZiB6UmF3UmFpZFR3ZWV0TWluaT47XG5cbmV4cG9ydCBmdW5jdGlvbiBtaW5pZnlSYXdSYWlkVHdlZXQodHdlZXQ6IFJhd1JhaWRUd2VldCk6IFJhd1JhaWRUd2VldE1pbmkge1xuICByZXR1cm4ge1xuICAgIG46IHR3ZWV0Lm5hbWUsXG4gICAgc246IHR3ZWV0LnNjcmVlbl9uYW1lLFxuICAgIGVuOiB0d2VldC5lbmVteV9uYW1lLFxuICAgIHVpOiB0d2VldC51c2VyX2lkLFxuICAgIHRpOiB0d2VldC50d2VldF9pZCxcbiAgICBiaTogdHdlZXQuYmF0dGxlX2lkLFxuICAgIGx2OiB0d2VldC5sZXZlbCxcbiAgICBsOiB0d2VldC5sYW5ndWFnZSxcbiAgICB0OiB0d2VldC50aW1lLFxuICAgIGV0OiB0d2VldC5lbGFwc2VkX3RpbWUsXG4gICAgYzogdHdlZXQuY29tbWVudCxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVucGFja1Jhd1JhaWRUd2VldE1pbmkobWluaTogUmF3UmFpZFR3ZWV0TWluaSk6IFJhd1JhaWRUd2VldCB7XG4gIHJldHVybiB7XG4gICAgbmFtZTogbWluaS5uLFxuICAgIHNjcmVlbl9uYW1lOiBtaW5pLnNuLFxuICAgIGVuZW15X25hbWU6IG1pbmkuZW4sXG4gICAgdXNlcl9pZDogbWluaS51aSxcbiAgICB0d2VldF9pZDogbWluaS50aSxcbiAgICBiYXR0bGVfaWQ6IG1pbmkuYmksXG4gICAgbGV2ZWw6IG1pbmkubHYsXG4gICAgbGFuZ3VhZ2U6IG1pbmkubCxcbiAgICB0aW1lOiBtaW5pLnQsXG4gICAgY29tbWVudDogbWluaS5jLFxuICAgIGVsYXBzZWRfdGltZTogbWluaS5ldCxcbiAgfTtcbn1cblxuLyoqXG4gKiDlrp/pmpvjgavphY3kv6HjgZXjgozjgovjg4TjgqTjg7zjg4jjg4fjg7zjgr9cbiAqL1xuZXhwb3J0IGNvbnN0IHpSYWlkVHdlZXRNaW5pID0gei5vYmplY3Qoe1xuICBuOiB6LnN0cmluZygpLCAvLyBuYW1lXG4gIHNuOiB6LnN0cmluZygpLCAvLyBzY3JlZW5fbmFtZVxuICB1aTogei5zdHJpbmcoKSwgLy8gdXNlcl9pZFxuICB0aTogei5zdHJpbmcoKSwgLy8gdHdlZXRfaWRcbiAgYmk6IHouc3RyaW5nKCksIC8vIGJhdHRsZV9pZFxuICBlaTogei5udW1iZXIoKSwgLy8gZW5lbXlfaWQoLTHjga/jg6rjgrnjg4jlpJYpXG4gIGx2OiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIGxldmVsXG4gIGVuOiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIGVuZW15X25hbWVcbiAgbDogei5lbnVtKFsnZW4nLCAnamEnXSksIC8vIGxhbmd1YWdlXG4gIHQ6IHoubnVtYmVyKCksIC8vIHRpbWVcbiAgZXQ6IHoubnVtYmVyKCksIC8vIGVsYXBzZWRfdGltZVxuICBmdDogei5udW1iZXIoKSwgLy8gZmlyc3QgdGltZSjliJ3lm57mipXnqL/mmYLplpMpXG4gIGM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSwgLy8gY29tbWVudFxufSk7XG5cbi8qKlxuICog5a++5b+cXFxcbiAqIG46IG5hbWVcXFxuICogc246IHNjcmVlX25hbWVcXFxuICogdWk6IHVzZXJfaWRcXFxuICogdGk6IHR3ZWV0X2lkXFxcbiAqIGJpOiBiYXR0bGVfaWRcXFxuICogZWk6IGVuZW15X2lkKC0x44Gv44Oq44K544OI5aSWKVxcXG4gKiBsOiBsYW5ndWFnZVxcXG4gKiB0OiB0aW1lXFxcbiAqIGZ0OiBmaXJzdF90aW1lKOWIneWbnuaKleeov+aZgumWk1xcXG4gKiBjOiBjb21tZW50XFxcbiAqIOODquOCueODiOWkluOBruOBv+i/veWKoFxcXG4gKiBlbj86IGVuZW15X25hbWVcXFxuICogbHY/OiBsZXZlbFxuICovXG5leHBvcnQgdHlwZSBSYWlkVHdlZXRNaW5pID0gei5pbmZlcjx0eXBlb2YgelJhaWRUd2VldE1pbmk+O1xuIiwiaW1wb3J0ICogYXMgZG90ZW52IGZyb20gJ2RvdGVudic7XG5pbXBvcnQgeyB6Q2FjaGVDb25maWcgfSBmcm9tICcuL2NhY2hlL2NvbmZpZyc7XG5pbXBvcnQgeyB6U2l0ZUNvbmZpZyB9IGZyb20gJy4vc2l0ZS9jb25maWcnO1xuaW1wb3J0IHsgelJlZGlzQ29uZmlnIH0gZnJvbSAnLi9yZWRpcy9jb25maWcnO1xuaW1wb3J0IHsgelR3ZWV0Q29uZmlnIH0gZnJvbSAnLi90d2VldC9jb25maWcnO1xuaW1wb3J0IHsgelN0cmVhbUNvbmZpZyB9IGZyb20gJy4vc3RyZWFtL2NvbmZpZyc7XG5kb3RlbnYuY29uZmlnKCk7XG5cbmV4cG9ydCBjb25zdCB6QWxsQ29uZmlnID0gekNhY2hlQ29uZmlnXG4gIC5tZXJnZSh6U2l0ZUNvbmZpZylcbiAgLm1lcmdlKHpSZWRpc0NvbmZpZylcbiAgLm1lcmdlKHpUd2VldENvbmZpZylcbiAgLm1lcmdlKHpTdHJlYW1Db25maWcpO1xuXG5leHBvcnQgY29uc3QgYWxsRW52ID0gekFsbENvbmZpZy5wYXJzZShwcm9jZXNzLmVudik7XG4iLCJpbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcclxuaW1wb3J0ICogYXMgZG90ZW52IGZyb20gJ2RvdGVudic7XHJcbmRvdGVudi5jb25maWcoKTtcclxuXHJcbmV4cG9ydCBjb25zdCB6Q2FjaGVDb25maWcgPSB6Lm9iamVjdCh7XHJcbiAgQ0FDSEVfUE9SVDogei5zdHJpbmcoKSxcclxuICBHQlNfTElTVDogei5zdHJpbmcoKS51cmwoKSxcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgY2FjaGVFbnYgPSB6Q2FjaGVDb25maWcucGFyc2UocHJvY2Vzcy5lbnYpO1xyXG4iLCJpbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcclxuaW1wb3J0ICogYXMgZG90ZW52IGZyb20gJ2RvdGVudic7XHJcbmRvdGVudi5jb25maWcoKTtcclxuXHJcbmV4cG9ydCBjb25zdCB6U2l0ZUNvbmZpZyA9IHoub2JqZWN0KHtcclxuICBQT1JUOiB6LnN0cmluZygpLFxyXG59KTtcclxuXHJcbmV4cG9ydCBjb25zdCBzaXRlRW52ID0gelNpdGVDb25maWcucGFyc2UocHJvY2Vzcy5lbnYpO1xyXG4iLCJpbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcclxuaW1wb3J0ICogYXMgZG90ZW52IGZyb20gJ2RvdGVudic7XHJcbmRvdGVudi5jb25maWcoKTtcclxuXHJcbmV4cG9ydCBjb25zdCB6VHdlZXRDb25maWcgPSB6Lm9iamVjdCh7XHJcbiAgQkVBUkVSOiB6LnN0cmluZygpLFxyXG4gIE9BVVRIX0NBTExCQUNLOiB6LnN0cmluZygpLnVybCgpLFxyXG4gIENPTlNVTUVSX0tFWTogei5zdHJpbmcoKSxcclxuICBDT05TVU1FUl9TRUNSRVQ6IHouc3RyaW5nKCksXHJcbn0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IHR3ZWV0RW52ID0gelR3ZWV0Q29uZmlnLnBhcnNlKHByb2Nlc3MuZW52KTtcclxuIiwiaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XHJcbmltcG9ydCAqIGFzIGRvdGVudiBmcm9tICdkb3RlbnYnO1xyXG5kb3RlbnYuY29uZmlnKCk7XHJcblxyXG5leHBvcnQgY29uc3QgelN0cmVhbUNvbmZpZyA9IHoub2JqZWN0KHtcclxuICBTVFJFQU1fUE9SVDogei5zdHJpbmcoKSxcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3Qgc3RyZWFtRW52ID0gelN0cmVhbUNvbmZpZy5wYXJzZShwcm9jZXNzLmVudik7XHJcbiJdfQ==